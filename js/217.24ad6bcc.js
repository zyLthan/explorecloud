"use strict";(self["webpackChunkshopping_app"]=self["webpackChunkshopping_app"]||[]).push([[217],{4217:function(t,s,a){a.r(s),a.d(s,{default:function(){return p}});var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"prodetail"},[s("van-nav-bar",{attrs:{fixed:"",title:"商品详情页","left-arrow":""},on:{"click-left":function(s){return t.$router.back()}}}),s("van-swipe",{attrs:{autoplay:3e3},on:{change:t.onChange},scopedSlots:t._u([{key:"indicator",fn:function(){return[s("div",{staticClass:"custom-indicator"},[t._v(t._s(t.current+1)+" / "+t._s(t.images.length))])]},proxy:!0}])},t._l(t.images,(function(t){return s("van-swipe-item",{key:t.file_id},[s("img",{attrs:{src:t.external_url}})])})),1),s("div",{staticClass:"info"},[s("div",{staticClass:"title"},[s("div",{staticClass:"price"},[s("span",{staticClass:"now"},[t._v("￥"+t._s(this.detail.goods_price_min))]),s("span",{staticClass:"oldprice"},[t._v("￥"+t._s(this.detail.goods_price_max))])]),s("div",{staticClass:"sellcount"},[t._v("已售"+t._s(this.detail.goods_sales)+"件")])]),s("div",{staticClass:"msg text-ellipsis-2"},[t._v(" "+t._s(this.detail.goods_name)+" ")]),s("div",{staticClass:"service"},[s("div",{staticClass:"left-words"},[s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v("七天无理由退货")],1),s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v("48小时发货")],1)]),s("div",{staticClass:"right-icon"},[s("van-icon",{attrs:{name:"arrow"}})],1)])]),s("div",{staticClass:"comment"},[s("div",{staticClass:"comment-title"},[s("div",{staticClass:"left"},[t._v("商品评价 ("+t._s(t.total)+"条)")]),s("div",{staticClass:"right"},[t._v("查看更多 "),s("van-icon",{attrs:{name:"arrow"}})],1)]),s("div",{staticClass:"comment-list"},t._l(t.comments.slice(0,2),(function(a){return s("div",{key:a.comment_id,staticClass:"comment-item"},[s("div",{staticClass:"top"},[s("img",{attrs:{src:a.user.avatar_url||t.defaultImg,alt:""}}),s("div",{staticClass:"name"},[t._v(t._s(a.user.nick_name))]),s("van-rate",{attrs:{size:16,value:5,color:"#ffd21e","void-icon":"star-o","void-color":"#eee"}})],1),s("div",{staticClass:"content"},[t._v(" "+t._s(a.content)+" ")]),s("div",{staticClass:"time"},[t._v(" "+t._s(a.create_time)+" ")])])})),0)]),s("div",{staticClass:"desc",domProps:{innerHTML:t._s(this.detail.content)}}),s("div",{staticClass:"footer"},[s("div",{staticClass:"icon-home"},[s("van-icon",{attrs:{name:"wap-home-o"}}),s("span",{on:{click:t.pathToHome}},[t._v("首页")])],1),s("div",{staticClass:"icon-cart"},[t.cartTotal>0?s("span",{staticClass:"num"},[t._v(t._s(t.cartTotal))]):t._e(),s("van-icon",{attrs:{name:"shopping-cart-o"}}),s("span",{on:{click:t.pathToShopcart}},[t._v("购物车")])],1),s("div",{staticClass:"btn-add",on:{click:t.addInShowcart}},[t._v("加入购物车")]),s("div",{staticClass:"btn-buy",on:{click:t.buyNow}},[t._v("立即购买")])]),s("van-action-sheet",{attrs:{title:"加入购物车"},model:{value:t.showShopcart,callback:function(s){t.showShopcart=s},expression:"showShopcart"}},[s("div",{staticClass:"product"},[s("div",{staticClass:"product-title"},[s("div",{staticClass:"left"},[s("img",{attrs:{src:t.detail.goods_image,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"price"},[s("span",[t._v("¥")]),s("span",{staticClass:"nowprice"},[t._v(t._s(t.detail.goods_price_min))])]),s("div",{staticClass:"count"},[s("span",[t._v("库存")]),s("span",[t._v(t._s(t.detail.stock_total))])])])]),s("div",{staticClass:"num-box"},[s("span",[t._v("数量")]),s("CountBox",{model:{value:t.shopnum,callback:function(s){t.shopnum=s},expression:"shopnum"}})],1),t.detail.stock_total>0&&t.shopnum<=t.detail.stock_total?s("div",{staticClass:"showbtn"},[s("div",{staticClass:"btn",on:{click:t.addInShopcartAfterLogin}},[t._v("加入购物车")])]):s("div",{staticClass:"btn-none"},[t._v("商品数量不足")])])]),s("van-action-sheet",{attrs:{title:"购买"},model:{value:t.showBuy,callback:function(s){t.showBuy=s},expression:"showBuy"}},[s("div",{staticClass:"product"},[s("div",{staticClass:"product-title"},[s("div",{staticClass:"left"},[s("img",{attrs:{src:t.detail.goods_image,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"price"},[s("span",[t._v("¥")]),s("span",{staticClass:"nowprice"},[t._v(t._s(t.detail.goods_price_min))])]),s("div",{staticClass:"count"},[s("span",[t._v("库存")]),s("span",[t._v(t._s(t.detail.stock_total))])])])]),s("div",{staticClass:"num-box"},[s("span",[t._v("数量")]),s("CountBox",{model:{value:t.buynum,callback:function(s){t.buynum=s},expression:"buynum"}})],1),t.detail.stock_total>0?s("div",{staticClass:"showbtn"},[s("div",{staticClass:"btn now",on:{click:t.goBuyNow}},[t._v("立即购买")])]):s("div",{staticClass:"btn-none"},[t._v("商品数量不足")])])])],1)},o=[],e=(a(4114),a(5720));const n=t=>e.A.get("/goods/detail",{params:{goodsId:t}}),c=(t,s)=>e.A.get("/comment/listRows",{params:{goodsId:t,limit:s}});var l=a(7767),r=a(2082),d=a(9652),u={name:"goodsdetailIndex",data(){return{images:[],current:0,detail:"",total:0,comments:[],defaultImg:l,showShopcart:!1,showBuy:!1,shopnum:1,buynum:1,cartTotal:0}},components:{CountBox:r.A},created(){this.getDetails(),this.getComments()},methods:{onChange(t){this.current=t},async getDetails(){const{data:{detail:t}}=await n(this.goodsId);this.detail=t,this.images=t.goods_images},async getComments(){const{data:{list:t,total:s}}=await c(this.goodsId);this.total=s,this.comments=t},pathToHome(){this.$router.push("/home")},pathToShopcart(){this.$router.push("/home/shopcart")},addInShowcart(){this.showShopcart=!0},buyNow(){this.showBuy=!0},goBuyNow(){this.$store.getters.token?this.$router.push({path:"/pay",query:{mode:"buyNow",goodsId:this.goodsId,goodsSkuId:this.detail.skuList[0].goods_sku_id,goodsNum:this.shopnum}}):this.$dialog.confirm({title:"请先登录",message:"此操作需要先登录",theme:"round-button",cancelButtonColor:"#19b284",cancelButtonText:"先逛逛",confirmButtonText:"登录"}).then((()=>{this.$router.replace({path:"/login",query:{backUrl:this.$route.fullPath}})})).catch((()=>{}))},async addInShopcartAfterLogin(){if(!this.$store.getters.token)return void this.$dialog.confirm({title:"请先登录",message:"此操作需要先登录",theme:"round-button",cancelButtonColor:"#19b284",cancelButtonText:"先逛逛",confirmButtonText:"登录"}).then((()=>{this.$router.replace({path:"/login",query:{backUrl:this.$route.fullPath}})})).catch((()=>{}));const{data:t}=await(0,d.Kv)(this.goodsId,this.shopnum,this.detail.skuList[0].goods_sku_id);this.cartTotal=t.cartTotal,this.$toast("加入购物车成功"),this.showBuy=!1,this.showShopcart=!1}},computed:{goodsId(){return this.$route.params.id},mode(){return this.$route.query.mode}}},h=u,v=a(1656),m=(0,v.A)(h,i,o,!1,null,"aa80e030",null),p=m.exports}}]);
//# sourceMappingURL=217.24ad6bcc.js.map